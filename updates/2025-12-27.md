# 2025-12-27

## 作業内容
- Cloud Build CI/CDパイプライン構築
  - `cloudbuild.yaml` 作成（Dockerイメージビルド＆Artifact Registry Push）
  - `terraform/cloudbuild.tf` 作成（Cloud Build Trigger + IAM設定）
  - GitHub 2nd gen接続 + リポジトリリンク設定
  - 接続名のtypo修正（recomender → recommender）
- mainブランチへのPushで自動ビルド＆プッシュが実行されるように
- Skills にCI/CD設定手順を追加
- TODO.md作成（インフラ課題 + マネタイズプラン）

## 学び

### Cloud Build 2nd gen設定
- **service_accountが必須**: 2nd genリポジトリを使うCloud Build Triggerには`service_account`の指定が必須。指定しないとエラー400（Invalid Argument）になる
- **GitHub接続の流れ**: GCPコンソールで接続作成 → リポジトリリンク → リポジトリIDを取得
- **リポジトリID形式**: `projects/{project}/locations/{region}/connections/{connection}/repositories/{repo}`

### Terraform + Cloud Build連携
- `google_cloudbuildv2_connection`/`google_cloudbuildv2_repository`のデータソースは未サポート（google providerでは利用不可）
- GCPコンソールで作成した接続は、変数でリポジトリIDを渡す形で参照する
- Cloud Buildサービスアカウントには`roles/artifactregistry.writer`権限が必要

### Load Balancer構成の理解
- `EXTERNAL_MANAGED`: 外部向け・新基盤のロードバランサー（IAP対応に必須）
- Serverless NEG: Cloud Runなどサーバーレスサービスをバックエンドとして使うためのアダプター
- Target HTTPS Proxy: SSL終端 + ルーティングを担当
