# 2026-01-12

## 作業内容
- Green環境の`OAUTH_REDIRECT_URI`を`http://localhost:8080`に変更（ローカルプロキシ対応）
- Cloud Build完了時のメール通知をCloud Monitoring アラートで実装（Terraform）
- Perplexity検索結果を必ず3件返すように修正（プロンプト + JSON schema制約）

## 学び
- **Cloud Monitoringのログベースアラート（`condition_matched_log`）の設定方法**
  - `condition_threshold`（メトリクスベース）ではなく`condition_matched_log`を使うことで、ログに直接マッチするアラートを作成可能
  - メトリクスが存在しない状態でもアラートを設定できる

- **TerraformでのMonitoring設定時のメトリクス問題**
  - `cloudbuild.googleapis.com/build/count`のような標準メトリクスは、Cloud Buildが一度も実行されていない場合は存在しないためエラーになる
  - ログベースメトリクス（`google_logging_metric`）も、データがないとアラートポリシー作成時にエラー
  - 解決策: `condition_matched_log`でログに直接マッチするアラートを使用
